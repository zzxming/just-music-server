import{a as q}from"./index.52c0da96.js";import{d as z,a8 as X,V as G,X as W,G as K,W as Q,r as x,M as U,a9 as Z,b as i,c as l,f as a,z as S,J as v,F as m,H as L,y as tt,t as _,aa as et,e as A,I as M,ab as st,x as ot,R as at,$ as nt,ac as it,ad as lt,a6 as ct,a7 as rt,_ as ut}from"./index.89431de9.js";const C=c=>(ct("data-v-fef2afcc"),c=c(),rt(),c),dt={class:"songlist"},_t={class:"songlist_header"},pt=C(()=>a("div",{class:"songlist_index"},null,-1)),gt=C(()=>a("div",{class:"songlist_title"},"\u6807\u9898",-1)),ft={key:0,class:"songlist_singer"},vt=C(()=>a("div",{class:"songlist_duration"},"\u65F6\u95F4",-1)),mt={class:"songlist_body"},yt=["draggable","onDblclick","onContextmenu","onDragstart","onDrop"],ht={class:"songlist_index"},Dt={class:"songlist_index-text"},xt={class:"el-icon songlist_index-icon playing"},St={class:"songlist_title"},bt={class:"songlist_title-title"},It=["title"],Lt={key:0,class:"el-icon songlist_title-icon"},Ct=["title"],Ft={class:"songlist_singer"},kt={class:"songlist_singer_item"},At=["title"],Mt={class:"songlist_singer"},Tt={class:"songlist_singer_item"},wt={class:"songlist_duration"},Bt={class:"songlist_duration"},Pt={key:0,class:"songlist_empty"},Ot=z({__name:"index",props:{songs:null,emptyText:{default:"\u8FD9\u91CC\u4EC0\u4E48\u90FD\u6CA1\u6709"},canDeleteSong:{type:Boolean,default:!1},canDrag:{type:Boolean,default:!1},isStatic:{type:Boolean,default:!0},loadMoreFunc:{type:Function,default:()=>0}},emits:["songOrder"],setup(c,{emit:T}){const u=c,I=X(),F=G(),w=W(),B=K(),{audioInfo:g}=Q(F),{setAudioInfo:P}=F,{playinglistReplace:O}=w,{setPopoutState:V}=B,b=x(g.value.id),k=x(g.value.cid);U(g,e=>{b.value=e.id,k.value=e.cid});const y=x(!0),h=x(!1),D=x();function E(){var t;if(!((t=D.value)!=null&&t.loadMore))return;new IntersectionObserver(async n=>{if(n[0].isIntersecting&&D.value){h.value=!1,y.value=!0;let p=await D.value.loadFunc();y.value=!1,p===-1&&(h.value=!0)}},{rootMargin:"0px 0px 400px 0px"}).observe(D.value.loadMore)}Z(async()=>{if(!u.isStatic)at(()=>E());else{h.value=!1,y.value=!0;let e=await u.loadMoreFunc();y.value=!1,e===-1&&(h.value=!0)}});async function N(e,t){(g.value.id!==t.id||g.value.type===nt.bili&&g.value.cid!==t.cid)&&(b.value=t.id,b.value=t.cid,P(t),O(u.songs))}function $(e,t){e.preventDefault(),V({popoutVisible:!0,popoutPosition:{left:e.pageX,top:e.pageY},popoutHoldData:t,popoutIsMusic:!0,popoutCanDelete:u.canDeleteSong})}function Y(e,t){var n;!u.canDrag||(n=e.dataTransfer)==null||n.setData("data",JSON.stringify(t))}function H(e){!u.canDrag||e.target&&(e.target.classList.remove("top"),e.target.classList.remove("bottom"))}function J(e){if(!u.canDrag)return;e.preventDefault();let t=e.composedPath().find(s=>Array.from(s.classList).includes("songlist_item")),n=t.offsetHeight,p=t.offsetTop;e.pageY<p+n/2?(t.classList.add("top"),t.classList.remove("bottom")):(t.classList.remove("top"),t.classList.add("bottom"))}function R(e,t){var f;if(!u.canDrag)return;let n=e.composedPath().find(j=>Array.from(j.classList).includes("songlist_item")),p=Array.from(n.classList),d=JSON.parse((f=e.dataTransfer)==null?void 0:f.getData("data")),s=t;if(p.includes("bottom")&&(s+=1),s<0&&(s=0),s===d){n.classList.remove("top"),n.classList.remove("bottom");return}let r=[...u.songs],o=r[d];r.splice(s,0,o),s<d?r.splice(d+1,1):r.splice(d,1),T("songOrder",r),n.classList.remove("top"),n.classList.remove("bottom")}return(e,t)=>{const n=it,p=lt,d=q;return i(),l(m,null,[a("div",dt,[a("div",_t,[pt,gt,S(I)?v("",!0):(i(),l("div",ft,"\u6B4C\u624B")),vt]),a("div",mt,[(i(!0),l(m,null,L(c.songs,(s,r)=>(i(),l("div",{class:tt(`songlist_item ${r%2===0?"stripe":""} ${b.value===s.id&&k.value===s.cid?"active":""} ${s.st===-200?"disable":""}`),draggable:c.canDrag,onDblclick:o=>N(o,s),onContextmenu:o=>$(o,s),onDragstart:o=>Y(o,r),onDragleave:t[0]||(t[0]=o=>H(o)),onDragover:t[1]||(t[1]=o=>J(o)),onDrop:o=>R(o,r)},[a("div",ht,[a("span",Dt,_(S(et)(r+1)),1),a("span",xt,[A(n)])]),a("div",St,[a("div",bt,[a("span",{class:"songlist_title-text",title:s.title},_(s.title),9,It),s.fee===1?(i(),l("span",Lt,[A(p)])):v("",!0)]),S(I)?(i(),l("div",{key:0,class:"songlist_title-singer",title:s.singers.map(o=>o.name).join(" / ")},[a("span",Ft,[(i(!0),l(m,null,L(s.singers,(o,f)=>(i(),l(m,null,[a("span",kt,_(o.name),1),M(" "+_(f===s.singers.length-1?"":"\xA0/\xA0"),1)],64))),256))])],8,Ct)):v("",!0)]),S(I)?v("",!0):(i(),l("div",{key:0,class:"songlist_singer",title:s.singers.map(o=>o.name).join(" / ")},[a("span",Mt,[(i(!0),l(m,null,L(s.singers,(o,f)=>(i(),l(m,null,[a("span",Tt,_(o.name),1),M(" "+_(f===s.singers.length-1?"":"\xA0/\xA0"),1)],64))),256))])],8,At)),a("div",wt,[a("span",Bt,_(S(st)(s.duration/1e3)),1)])],42,yt))),256)),c.songs.length<1&&!h.value?(i(),l("div",Pt,_(y.value?"\u52A0\u8F7D\u4E2D...":c.emptyText),1)):v("",!0)])]),c.isStatic?v("",!0):(i(),ot(d,{key:"loadingSong",ref_key:"loadMore",ref:D,requestFunc:c.loadMoreFunc},null,8,["requestFunc"]))],64)}}});const Nt=ut(Ot,[["__scopeId","data-v-fef2afcc"]]);export{Nt as _};
