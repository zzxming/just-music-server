import{d as A,g as _,p as N,s as C,q as j,A as E,o as n,c as h,a as I,b as M,w as B,y as q,f as b,k as m,I as w,z as R,K as u,ac as U,O as z,e as D,B as K,F as L,i as Q,t as T,u as W,ad as G,U as H,_ as J}from"./index.d3614d96.js";import{S as P,c as X,s as Y}from"./index.2db69e03.js";import{L as Z,a as $}from"./index.4748948e.js";const ee={class:"search"},ae={class:"search_type"},te={class:"search_type_item"},se={class:"search_result"};var y=(i=>(i.bili="\u54D4\u54E9\u54D4\u54E9",i.local="just",i.cloud="\u7F51\u6613\u4E91\u97F3\u4E50",i))(y||{});const ue=A({__name:"index",props:{kw:null,t:null},setup(i){const r=i,V=W(),g=G(),f=_(),a=_(r.t),x=_(1),c=_(1),s=_(!0),o=_(!1),p=N([]);C(a,t=>{E(()=>F()),!(g.query.kw===r.kw&&g.query.t===t)&&V.push(H(g.path,{kw:r.kw,t}))}),C(()=>r,t=>{a.value=u[t.t],c.value=1,s.value=!0,o.value=!1,p.length=0,k(!0)},{deep:!0,immediate:!0}),j(()=>{E(()=>F())});function F(){if(!f.value)return;new IntersectionObserver(function(e){e[0].isIntersecting&&f.value&&!s.value&&f.value.loadFunc()},{rootMargin:"0px 0px 200px 0px"}).observe(f.value.loadMore)}function O(t){a.value=u[t],c.value=1,s.value=!0,o.value=!1}async function k(t=!1){o.value=!1;let e,l;switch(a.value){case u.bili:{[e,l]=await Y(r.kw);break}case u.local:{[e,l]=await X({kw:r.kw,limit:c.value,t:x.value}),c.value+=1;break}case u.cloud:{[e,l]=await U({kw:r.kw,limit:c.value,t:x.value}),c.value+=1;break}default:e=null,l=void 0}if(!e&&l){t&&(p.length=0),s.value=!1;let d=l.data;return p.push(...z(d.data,a.value)),d.data.length<1||p.length>=d.count?0:d.data.length}else if(e)return s.value=!1,e.response&&e.response.status>=500?(o.value=!0,-1):0;return-1}return(t,e)=>{const l=D("el-tab-pane"),d=D("el-tabs"),S=K("loading");return n(),h("div",ee,[I("div",ae,[M(d,{class:"search_header",modelValue:a.value,"onUpdate:modelValue":e[0]||(e[0]=v=>a.value=v),stretch:!0,onTabChange:O},{default:B(()=>[(n(!0),h(L,null,Q(m(u),v=>(n(),h(L,null,[v!==m(u).local?(n(),b(l,{key:0,label:y[v],name:v},{label:B(()=>[I("div",te,T(y[v]),1)]),_:2},1032,["label","name"])):w("",!0)],64))),256))]),_:1},8,["modelValue"])]),q((n(),h("div",se,[!s.value||!o.value?(n(),b(P,{key:0,songs:p,emptyText:a.value===m(u).bili?"\u8BF7\u8F93\u5165\u6B63\u786E\u7684bv\u53F7":"\u6CA1\u6709\u641C\u7D22\u5230\u76F8\u5173\u6B4C\u66F2"},null,8,["songs","emptyText"])):w("",!0)])),[[S,s.value&&!o.value]]),M(Z,{isError:s.value&&o.value,requestFunc:()=>k(!0)},null,8,["isError","requestFunc"]),a.value!==m(u).bili?q((n(),b($,{key:a.value,ref_key:"loadMore",ref:f,requestFunc:k})),[[R,!s.value]]):w("",!0)])}}});const ne=J(ue,[["__scopeId","data-v-e8adfa91"]]);export{ne as default};
