import{a as K,_ as Q}from"./index.6754e4d5.js";import{d as U,u as tt,a8 as et,V as st,X as ot,G as at,W as nt,r as k,M as it,a9 as lt,b as a,c as i,f as l,z as u,J as r,F as x,H as A,y as ct,t as f,aa as rt,e as L,I as P,ab as ut,g as dt,Z as _t,x as O,R as pt,$ as gt,ac as ft,ad as mt,E as vt,a6 as yt,a7 as ht,_ as Dt}from"./index.93b487f7.js";import{_ as xt}from"./more-outlined.22939d11.js";const V=c=>(yt("data-v-bef8468b"),c=c(),ht(),c),St={class:"songlist"},bt={key:0,class:"songlist_header"},kt=V(()=>l("div",{class:"songlist_index"},null,-1)),It=V(()=>l("div",{class:"songlist_title"},"\u6807\u9898",-1)),Lt={key:0,class:"songlist_singer"},Ct={key:1,class:"songlist_duration"},Ft={key:2,class:"songlist_option"},At={class:"songlist_body"},Mt=["draggable","onClick","onDblclick","onContextmenu","onDragstart","onDrop"],wt={class:"songlist_index"},Et={class:"songlist_index-text"},Tt={class:"el-icon songlist_index-icon playing"},Bt={class:"songlist_title"},Pt={class:"songlist_title-title"},Ot=["title"],Vt={key:0,class:"el-icon songlist_title-icon"},$t=["title"],Nt={class:"songlist_singer"},Rt={class:"songlist_singer_item"},Yt=["title"],qt={class:"songlist_singer"},Ht={class:"songlist_singer_item"},Jt={key:1,class:"songlist_duration"},jt={class:"songlist_duration"},zt={key:2,class:"songlist_option"},Xt={key:0,class:"songlist_empty"},Gt=U({__name:"index",props:{songs:null,emptyText:{default:"\u8FD9\u91CC\u4EC0\u4E48\u90FD\u6CA1\u6709"},canDeleteSong:{type:Boolean,default:!1},canDrag:{type:Boolean,default:!1},isStatic:{type:Boolean,default:!0},loadMoreFunc:{type:Function,default:()=>0}},emits:["songOrder"],setup(c,{emit:$}){const _=c,N=tt(),p=et(),M=st(),R=ot(),Y=at(),{audio:q,audioInfo:y}=nt(M),{setAudioInfo:H}=M,{playinglistReplace:J}=R,{setPopoutState:j}=Y,I=k(y.value.id),w=k(y.value.cid);it(y,e=>{I.value=e.id,w.value=e.cid});const S=k(!0),h=k(!1),b=k();function z(){var t;if(!((t=b.value)!=null&&t.loadMore))return;new IntersectionObserver(async n=>{if(n[0].isIntersecting&&b.value){h.value=!1,S.value=!0;let m=await b.value.loadFunc();S.value=!1,m===-1&&(h.value=!0)}},{rootMargin:"0px 0px 400px 0px"}).observe(b.value.loadMore)}lt(async()=>{_.isStatic?E():pt(()=>z())});async function E(){h.value=!1,S.value=!0;let e=await _.loadMoreFunc();S.value=!1,e===-1&&(h.value=!0)}async function T(e,t){var n;(y.value.id!==t.id||y.value.type===gt.bili&&y.value.cid!==t.cid)&&(I.value=t.id,I.value=t.cid,H(t),J(_.songs),(n=q.value)==null||n.load(),N.push("/player"))}function B(e,t){e.preventDefault(),j({popoutVisible:!0,popoutPosition:{left:e.pageX,top:e.pageY},popoutHoldData:t,popoutIsMusic:!0,popoutCanDelete:_.canDeleteSong})}function X(e,t){var n;!_.canDrag||(n=e.dataTransfer)==null||n.setData("data",JSON.stringify(t))}function G(e){!_.canDrag||e.target&&(e.target.classList.remove("top"),e.target.classList.remove("bottom"))}function W(e){if(!_.canDrag)return;e.preventDefault();let t=e.composedPath().find(d=>Array.from(d.classList).includes("songlist_item")),n=t.offsetHeight,m=t.offsetTop;e.pageY<m+n/2?(t.classList.add("top"),t.classList.remove("bottom")):(t.classList.remove("top"),t.classList.add("bottom"))}function Z(e,t){var o;if(!_.canDrag)return;let n=e.composedPath().find(D=>Array.from(D.classList).includes("songlist_item")),m=Array.from(n.classList),g=JSON.parse((o=e.dataTransfer)==null?void 0:o.getData("data")),d=t;if(m.includes("bottom")&&(d+=1),d<0&&(d=0),d===g){n.classList.remove("top"),n.classList.remove("bottom");return}let v=[..._.songs],C=v[g];v.splice(d,0,C),d<g?v.splice(g+1,1):v.splice(g,1),$("songOrder",v),n.classList.remove("top"),n.classList.remove("bottom")}return(e,t)=>{const n=ft,m=mt,g=xt,d=vt,v=K,C=Q;return a(),i(x,null,[l("div",St,[u(p)?r("",!0):(a(),i("div",bt,[kt,It,u(p)?r("",!0):(a(),i("div",Lt,"\u6B4C\u624B")),u(p)?r("",!0):(a(),i("div",Ct,"\u65F6\u95F4")),u(p)?(a(),i("div",Ft)):r("",!0)])),l("div",At,[(a(!0),i(x,null,A(c.songs,(o,D)=>(a(),i("div",{class:ct(`songlist_item ${D%2===0?"stripe":""} ${I.value===o.id&&w.value===o.cid?"active":""} ${o.st===-200?"disable":""}`),draggable:c.canDrag,onClick:s=>u(p)&&T(s,o),onDblclick:s=>T(s,o),onContextmenu:s=>B(s,o),onDragstart:s=>X(s,D),onDragleave:t[0]||(t[0]=s=>G(s)),onDragover:t[1]||(t[1]=s=>W(s)),onDrop:s=>Z(s,D)},[l("div",wt,[l("span",Et,f(u(rt)(D+1)),1),l("span",Tt,[L(n)])]),l("div",Bt,[l("div",Pt,[l("span",{class:"songlist_title-text",title:o.title},f(o.title),9,Ot),o.fee===1?(a(),i("span",Vt,[L(m)])):r("",!0)]),u(p)?(a(),i("div",{key:0,class:"songlist_title-singer",title:o.singers.map(s=>s.name).join(" / ")},[l("span",Nt,[(a(!0),i(x,null,A(o.singers,(s,F)=>(a(),i(x,null,[l("span",Rt,f(s.name),1),P(" "+f(F===o.singers.length-1?"":"\xA0/\xA0"),1)],64))),256))])],8,$t)):r("",!0)]),u(p)?r("",!0):(a(),i("div",{key:0,class:"songlist_singer",title:o.singers.map(s=>s.name).join(" / ")},[l("span",qt,[(a(!0),i(x,null,A(o.singers,(s,F)=>(a(),i(x,null,[l("span",Ht,f(s.name),1),P(" "+f(F===o.singers.length-1?"":"\xA0/\xA0"),1)],64))),256))])],8,Yt)),u(p)?r("",!0):(a(),i("div",Jt,[l("span",jt,f(u(ut)(o.duration/1e3)),1)])),u(p)?(a(),i("div",zt,[L(d,{class:"",onClick:_t(s=>B(s,o),["stop"])},{default:dt(()=>[L(g)]),_:2},1032,["onClick"])])):r("",!0)],42,Mt))),256)),c.isStatic&&c.songs.length<1&&!h.value?(a(),i("div",Xt,f(S.value?"\u52A0\u8F7D\u4E2D...":c.emptyText),1)):r("",!0)])]),c.isStatic?r("",!0):(a(),O(v,{key:"loadingSong",ref_key:"loadMore",ref:b,requestFunc:c.loadMoreFunc},null,8,["requestFunc"])),c.isStatic?(a(),O(C,{key:1,isError:h.value,requestFunc:E,style:{height:"200px"}},null,8,["isError"])):r("",!0)],64)}}});const Qt=Dt(Gt,[["__scopeId","data-v-bef8468b"]]);export{Qt as _};
