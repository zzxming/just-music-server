import{a as K,_ as Q}from"./index.c5b50cd2.js";import{d as U,u as tt,a8 as et,V as st,X as ot,G as nt,W as at,l as it,r as S,M as lt,o as rt,R as ct,b as a,c as i,z as r,J as _,f as l,F as I,H as M,y as ut,t as m,a9 as dt,e as D,I as B,aa as _t,g as pt,Z as gt,$ as ft,ab as mt,ac as vt,E as yt,a6 as ht,a7 as Dt,_ as xt}from"./index.4dea08ff.js";import{_ as St}from"./more-outlined.d60f6fa6.js";const O=g=>(ht("data-v-c766f108"),g=g(),Dt(),g),It={class:"songlist"},bt={key:0,class:"songlist_header"},kt=O(()=>l("div",{class:"songlist_index"},null,-1)),Lt=O(()=>l("div",{class:"songlist_title"},"\u6807\u9898",-1)),Ct={key:0,class:"songlist_singer"},Ft={key:1,class:"songlist_duration"},Mt={key:2,class:"songlist_option"},At={class:"songlist_body"},wt=["draggable","onClick","onDblclick","onContextmenu","onDragstart","onDrop"],Tt={class:"songlist_index"},Et={class:"songlist_index-text"},Pt={class:"el-icon songlist_index-icon playing"},Bt={class:"songlist_title"},Ot={class:"songlist_title-title"},Vt=["title"],$t={key:0,class:"el-icon songlist_title-icon"},Nt=["title"],Rt={class:"songlist_singer"},Yt={class:"songlist_singer_item"},qt=["title"],Ht={class:"songlist_singer"},Jt={class:"songlist_singer_item"},jt={key:1,class:"songlist_duration"},zt={class:"songlist_duration"},Xt={key:2,class:"songlist_option"},Gt=U({__name:"index",props:{songs:null,emptyText:{default:"\u8FD9\u91CC\u4EC0\u4E48\u90FD\u6CA1\u6709"},canDeleteSong:{type:Boolean,default:!1},canDrag:{type:Boolean,default:!1},isStatic:{type:Boolean,default:!0},loadMoreFunc:{type:Function,default:()=>0}},emits:["songOrder"],setup(g,{emit:V}){const c=g,$=tt(),d=et(),A=st(),N=ot(),R=nt(),{audio:Y,audioInfo:v}=at(A),{setAudioInfo:q}=A,{playinglistReplace:H}=N,{setPopoutState:J}=R,j=it(()=>c.isStatic?async()=>(await c.loadMoreFunc(),0):c.loadMoreFunc),b=S(v.value.id),w=S(v.value.cid);lt(v,e=>{b.value=e.id,w.value=e.cid});const T=S(!0),k=S(!1),y=S();function z(){var t;if(!((t=y.value)!=null&&t.loadMore))return;new IntersectionObserver(async n=>{n[0].isIntersecting&&y.value&&L()},{rootMargin:"0px 0px 400px 0px"}).observe(y.value.loadMore)}rt(()=>{c.isStatic?L():ct(()=>z())});async function L(){if(!y.value)return;k.value=!1,T.value=!0;let e=await y.value.loadFunc();T.value=!1,e===-1&&(k.value=!0)}async function E(e,t){var n;(v.value.id!==t.id||v.value.type===ft.bili&&v.value.cid!==t.cid)&&(b.value=t.id,b.value=t.cid,q(t),H(c.songs),(n=Y.value)==null||n.load(),$.push("/player"))}function P(e,t){e.preventDefault(),J({popoutVisible:!0,popoutPosition:{left:e.pageX,top:e.pageY},popoutHoldData:t,popoutIsMusic:!0,popoutCanDelete:c.canDeleteSong})}function X(e,t){var n;!c.canDrag||(n=e.dataTransfer)==null||n.setData("data",JSON.stringify(t))}function G(e){!c.canDrag||e.target&&(e.target.classList.remove("top"),e.target.classList.remove("bottom"))}function W(e){if(!c.canDrag)return;e.preventDefault();let t=e.composedPath().find(u=>Array.from(u.classList).includes("songlist_item")),n=t.offsetHeight,x=t.offsetTop;e.pageY<x+n/2?(t.classList.add("top"),t.classList.remove("bottom")):(t.classList.remove("top"),t.classList.add("bottom"))}function Z(e,t){var o;if(!c.canDrag)return;let n=e.composedPath().find(h=>Array.from(h.classList).includes("songlist_item")),x=Array.from(n.classList),p=JSON.parse((o=e.dataTransfer)==null?void 0:o.getData("data")),u=t;if(x.includes("bottom")&&(u+=1),u<0&&(u=0),u===p){n.classList.remove("top"),n.classList.remove("bottom");return}let f=[...c.songs],C=f[p];f.splice(u,0,C),u<p?f.splice(p+1,1):f.splice(p,1),V("songOrder",f),n.classList.remove("top"),n.classList.remove("bottom")}return(e,t)=>{const n=mt,x=vt,p=St,u=yt,f=K,C=Q;return a(),i("div",It,[r(d)?_("",!0):(a(),i("div",bt,[kt,Lt,r(d)?_("",!0):(a(),i("div",Ct,"\u6B4C\u624B")),r(d)?_("",!0):(a(),i("div",Ft,"\u65F6\u95F4")),r(d)?(a(),i("div",Mt)):_("",!0)])),l("div",At,[(a(!0),i(I,null,M(g.songs,(o,h)=>(a(),i("div",{class:ut(`songlist_item ${h%2===0?"stripe":""} ${b.value===o.id&&w.value===o.cid?"active":""} ${o.st===-200?"disable":""}`),draggable:g.canDrag,onClick:s=>r(d)&&E(s,o),onDblclick:s=>E(s,o),onContextmenu:s=>P(s,o),onDragstart:s=>X(s,h),onDragleave:t[0]||(t[0]=s=>G(s)),onDragover:t[1]||(t[1]=s=>W(s)),onDrop:s=>Z(s,h)},[l("div",Tt,[l("span",Et,m(r(dt)(h+1)),1),l("span",Pt,[D(n)])]),l("div",Bt,[l("div",Ot,[l("span",{class:"songlist_title-text",title:o.title},m(o.title),9,Vt),o.fee===1?(a(),i("span",$t,[D(x)])):_("",!0)]),r(d)?(a(),i("div",{key:0,class:"songlist_title-singer",title:o.singers.map(s=>s.name).join(" / ")},[l("span",Rt,[(a(!0),i(I,null,M(o.singers,(s,F)=>(a(),i(I,null,[l("span",Yt,m(s.name),1),B(" "+m(F===o.singers.length-1?"":"\xA0/\xA0"),1)],64))),256))])],8,Nt)):_("",!0)]),r(d)?_("",!0):(a(),i("div",{key:0,class:"songlist_singer",title:o.singers.map(s=>s.name).join(" / ")},[l("span",Ht,[(a(!0),i(I,null,M(o.singers,(s,F)=>(a(),i(I,null,[l("span",Jt,m(s.name),1),B(" "+m(F===o.singers.length-1?"":"\xA0/\xA0"),1)],64))),256))])],8,qt)),r(d)?_("",!0):(a(),i("div",jt,[l("span",zt,m(r(_t)(o.duration/1e3)),1)])),r(d)?(a(),i("div",Xt,[D(u,{class:"",onClick:gt(s=>P(s,o),["stop"])},{default:pt(()=>[D(p)]),_:2},1032,["onClick"])])):_("",!0)],42,wt))),256)),D(f,{key:"loadingSong",ref_key:"loadMore",ref:y,requestFunc:r(j)},null,8,["requestFunc"]),D(C,{isError:k.value,requestFunc:L,style:{height:"200px"}},null,8,["isError"])])])}}});const Qt=xt(Gt,[["__scopeId","data-v-c766f108"]]);export{Qt as _};
